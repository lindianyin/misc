<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LibU: bst.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Intro</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_000000.html">srcs</a>&nbsp;&raquo;&nbsp;<a class="el" href="dir_000001.html">toolbox</a>
  </div>
</div>
<div class="contents">
<h1>srcs/toolbox/bst.c</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* </span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (c) 2005-2012 by KoanLogic s.r.l.</span>
<a name="l00003"></a>00003 <span class="comment"> */</span>
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;toolbox/bst.h&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;toolbox/carpal.h&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;toolbox/memory.h&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;toolbox/misc.h&gt;</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="keyword">struct </span>u_bst_node_s
<a name="l00011"></a>00011 {
<a name="l00012"></a>00012     <span class="keywordtype">void</span> *key, *val;                    <span class="comment">/* node&#39;s key and value. */</span>
<a name="l00013"></a>00013     <span class="keywordtype">size_t</span> nelem;                       <span class="comment">/* number of elements in the subtrees</span>
<a name="l00014"></a>00014 <span class="comment">                                           rooted in this node. */</span>
<a name="l00015"></a>00015     <span class="keyword">struct </span>u_bst_node_s *left, *right;  <span class="comment">/* left and right subtrees. */</span>
<a name="l00016"></a>00016 };
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="keyword">struct </span>u_bst_s
<a name="l00019"></a>00019 {
<a name="l00020"></a>00020     <span class="keywordtype">int</span> opts;
<a name="l00021"></a>00021     int (*cmp) (<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *);    <span class="comment">/* key compare function. */</span>
<a name="l00022"></a>00022     <a class="code" href="group__bst.html#ga346c18f1f674e1e05bdef8d77ea85799" title="Available types for BST containers.">u_bst_type_t</a> keytype, valtype;              <span class="comment">/* nature of keys and values. */</span>
<a name="l00023"></a>00023     <span class="keywordtype">size_t</span> keysize, valsize;                    <span class="comment">/* size of keys and values. */</span>
<a name="l00024"></a>00024     void (*keyfree) (<span class="keywordtype">void</span> *);                   <span class="comment">/* key dtor. */</span>
<a name="l00025"></a>00025     void (*valfree) (<span class="keywordtype">void</span> *);                   <span class="comment">/* value dtor. */</span>
<a name="l00026"></a>00026     <span class="keyword">struct </span>u_bst_node_s *root;                  <span class="comment">/* parent node reference. */</span>
<a name="l00027"></a>00027 };
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="keyword">static</span> <span class="keywordtype">int</span> u_bst_keycmp (<span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b);
<a name="l00030"></a>00030 <span class="keyword">static</span> <span class="keywordtype">void</span> u_bst_genfree (<span class="keywordtype">void</span> *p);
<a name="l00031"></a>00031 <span class="keyword">static</span> <span class="keywordtype">int</span> u_bst_node_new (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *val, 
<a name="l00032"></a>00032         <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> **pnode);
<a name="l00033"></a>00033 <span class="keyword">static</span> <span class="keywordtype">void</span> u_bst_node_free (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node);
<a name="l00034"></a>00034 <span class="keyword">static</span> <span class="keywordtype">void</span> u_bst_node_do_free (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node);
<a name="l00035"></a>00035 <span class="keyword">static</span> <span class="keywordtype">int</span> u_bst_assign (<span class="keywordtype">void</span> **pdst, <span class="keyword">const</span> <span class="keywordtype">void</span> *src, <a class="code" href="group__bst.html#ga346c18f1f674e1e05bdef8d77ea85799" title="Available types for BST containers.">u_bst_type_t</a> t, 
<a name="l00036"></a>00036         <span class="keywordtype">size_t</span> sz);
<a name="l00037"></a>00037 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_search (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, <span class="keyword">const</span> <span class="keywordtype">void</span> *key, 
<a name="l00038"></a>00038         <span class="keywordtype">int</span> (*cmp)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *));
<a name="l00039"></a>00039 <span class="keyword">static</span> <span class="keywordtype">void</span> u_bst_node_foreach (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, 
<a name="l00040"></a>00040         <span class="keywordtype">void</span> (*cb)(<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *, <span class="keywordtype">void</span> *), <span class="keywordtype">void</span> *cb_args);
<a name="l00041"></a>00041 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_push_top (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, 
<a name="l00042"></a>00042         <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *val);
<a name="l00043"></a>00043 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_push_bottom (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keyword">const</span> <span class="keywordtype">void</span> *key, 
<a name="l00044"></a>00044         <span class="keyword">const</span> <span class="keywordtype">void</span> *val);
<a name="l00045"></a>00045 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_push_rand (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node,
<a name="l00046"></a>00046         <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *val);
<a name="l00047"></a>00047 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_push (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, 
<a name="l00048"></a>00048         <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *val);
<a name="l00049"></a>00049 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_find_nth (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, <span class="keywordtype">size_t</span> n);
<a name="l00050"></a>00050 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_promote_nth (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, <span class="keywordtype">size_t</span> n);
<a name="l00051"></a>00051 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_join_lr (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *l, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *r);
<a name="l00052"></a>00052 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_delete (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, 
<a name="l00053"></a>00053         <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">int</span> *pfound);
<a name="l00054"></a>00054 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_balance (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node);
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="preprocessor">#ifdef BST_DEBUG</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> u_bst_keycmp_dbg (<span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b);
<a name="l00058"></a>00058 <span class="preprocessor">#endif  </span><span class="comment">/* BST_DEBUG */</span>
<a name="l00059"></a>00059 
<a name="l00136"></a><a class="code" href="group__bst.html#ga3471b2189b60cf5f50c43f35cca24245">00136</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#ga3471b2189b60cf5f50c43f35cca24245" title="Create a new u_bst_t object.">u_bst_new</a> (<span class="keywordtype">int</span> opts, <a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> **pbst)
<a name="l00137"></a>00137 {
<a name="l00138"></a>00138     <a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst = NULL;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     dbg_return_if (pbst == NULL, ~0);
<a name="l00141"></a>00141 
<a name="l00142"></a>00142     warn_return_sif ((bst = <a class="code" href="group__alloc.html#gab61921b41f57b91c825ef811200e8577" title="Wrapper for malloc-like function.">u_malloc</a>(<span class="keyword">sizeof</span> *bst)) == NULL, ~0);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     bst-&gt;keytype = <a class="code" href="group__bst.html#gga346c18f1f674e1e05bdef8d77ea85799a8b7147090840d0f9591334943471021d">U_BST_TYPE_STRING</a>;
<a name="l00145"></a>00145     bst-&gt;keyfree = u_bst_genfree;
<a name="l00146"></a>00146     bst-&gt;valtype = <a class="code" href="group__bst.html#gga346c18f1f674e1e05bdef8d77ea85799ab77c08797b87f64eaf0c5f6e92d71daf">U_BST_TYPE_PTR</a>;
<a name="l00147"></a>00147     bst-&gt;valfree = NULL;
<a name="l00148"></a>00148 <span class="preprocessor">#ifdef BST_DEBUG</span>
<a name="l00149"></a>00149 <span class="preprocessor"></span>    bst-&gt;cmp = u_bst_keycmp_dbg;
<a name="l00150"></a>00150 <span class="preprocessor">#else</span>
<a name="l00151"></a>00151 <span class="preprocessor"></span>    bst-&gt;cmp = u_bst_keycmp;
<a name="l00152"></a>00152 <span class="preprocessor">#endif  </span><span class="comment">/* BST_DEBUG */</span>
<a name="l00153"></a>00153     bst-&gt;root = NULL;
<a name="l00154"></a>00154     bst-&gt;opts = opts;
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     <span class="comment">/* Seed the PRNG in case we need to handle randomized insertion. */</span>
<a name="l00157"></a>00157     <span class="keywordflow">if</span> (bst-&gt;opts &amp; <a class="code" href="group__bst.html#gga4a17f1bfc5fa6007da2eed53de1ce882a17c969c1b1c9b89b2aef7e412170cd01">U_BST_OPT_RANDOMIZED</a>)
<a name="l00158"></a>00158         srand((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) getpid()); 
<a name="l00159"></a>00159 
<a name="l00160"></a>00160     *pbst = bst;
<a name="l00161"></a>00161 
<a name="l00162"></a>00162     <span class="keywordflow">return</span> 0;
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00174"></a><a class="code" href="group__bst.html#ga83495c34927dacf538976b8058c33101">00174</a> <span class="keywordtype">void</span> <a class="code" href="group__bst.html#ga83495c34927dacf538976b8058c33101" title="Destroy an u_bst_t object.">u_bst_free</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst)
<a name="l00175"></a>00175 {
<a name="l00176"></a>00176     <span class="keywordflow">if</span> (bst)
<a name="l00177"></a>00177     {
<a name="l00178"></a>00178         u_bst_node_free(bst, bst-&gt;root);
<a name="l00179"></a>00179         <a class="code" href="group__alloc.html#ga8a480341289bf5fc1a72e7974c4a739d" title="Wrapper for free-like function, sanity checks the supplied pointer.">u_free</a>(bst);
<a name="l00180"></a>00180     }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182     <span class="keywordflow">return</span>;
<a name="l00183"></a>00183 }
<a name="l00184"></a>00184 
<a name="l00201"></a><a class="code" href="group__bst.html#ga667c15bbe38095c058b5d2753f01e36f">00201</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#ga667c15bbe38095c058b5d2753f01e36f" title="Insert a new node into the BST.">u_bst_push</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *val)
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203     dbg_return_if (bst == NULL, ~0);
<a name="l00204"></a>00204     dbg_return_if (key == NULL, ~0);
<a name="l00205"></a>00205 
<a name="l00206"></a>00206     <span class="keywordflow">if</span> (bst-&gt;opts &amp; <a class="code" href="group__bst.html#gga4a17f1bfc5fa6007da2eed53de1ce882a17c969c1b1c9b89b2aef7e412170cd01">U_BST_OPT_RANDOMIZED</a>)
<a name="l00207"></a>00207         bst-&gt;root = u_bst_node_push_rand(bst, bst-&gt;root, key, val);
<a name="l00208"></a>00208     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (bst-&gt;opts &amp; <a class="code" href="group__bst.html#gga4a17f1bfc5fa6007da2eed53de1ce882aca362a6d8bfb1ff24c098a0e8b630d7b">U_BST_OPT_PUSH_TOP</a>)
<a name="l00209"></a>00209         bst-&gt;root = u_bst_node_push_top(bst, bst-&gt;root, key, val);
<a name="l00210"></a>00210     <span class="keywordflow">else</span> <span class="comment">/* The default is bottom insertion. */</span>
<a name="l00211"></a>00211         bst-&gt;root = u_bst_node_push_bottom(bst, key, val);
<a name="l00212"></a>00212 
<a name="l00213"></a>00213     <span class="keywordflow">return</span> bst-&gt;root ? 0 : ~0;
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 
<a name="l00227"></a><a class="code" href="group__bst.html#ga17d514874f96b5f3d3c241b5bfdec45f">00227</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#ga17d514874f96b5f3d3c241b5bfdec45f" title="Evict a node from the BST given its key.">u_bst_delete</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keyword">const</span> <span class="keywordtype">void</span> *key)
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229     <span class="keywordtype">int</span> found = 0;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     dbg_return_if (bst == NULL, ~0);
<a name="l00232"></a>00232     dbg_return_if (key == NULL, ~0);
<a name="l00233"></a>00233 
<a name="l00234"></a>00234     bst-&gt;root = u_bst_node_delete(bst, bst-&gt;root, key, &amp;found);
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="keywordflow">return</span> found ? 0 : ~0;
<a name="l00237"></a>00237 }
<a name="l00238"></a>00238 
<a name="l00251"></a><a class="code" href="group__bst.html#ga9e8376914e046b0102b59ae72243dddf">00251</a> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *<a class="code" href="group__bst.html#ga9e8376914e046b0102b59ae72243dddf" title="Search for a node matching a given key.">u_bst_search</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keyword">const</span> <span class="keywordtype">void</span> *key)
<a name="l00252"></a>00252 {
<a name="l00253"></a>00253     dbg_return_if (bst == NULL, NULL);
<a name="l00254"></a>00254     dbg_return_if (key == NULL, NULL);
<a name="l00255"></a>00255 
<a name="l00256"></a>00256     <span class="keywordflow">return</span> u_bst_node_search(bst-&gt;root, key, bst-&gt;cmp);
<a name="l00257"></a>00257 }
<a name="l00258"></a>00258 
<a name="l00271"></a><a class="code" href="group__bst.html#gaacae0dc86651908a637c7a89d93f2da5">00271</a> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *<a class="code" href="group__bst.html#gaacae0dc86651908a637c7a89d93f2da5" title="Find the n-th element in the BST.">u_bst_find_nth</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keywordtype">size_t</span> n)
<a name="l00272"></a>00272 {
<a name="l00273"></a>00273     dbg_return_if (bst == NULL, NULL);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275     <span class="keywordflow">return</span> u_bst_node_find_nth(bst-&gt;root, n);
<a name="l00276"></a>00276 }
<a name="l00277"></a>00277 
<a name="l00288"></a><a class="code" href="group__bst.html#gadf6af5b31627428453d3136289091871">00288</a> ssize_t <a class="code" href="group__bst.html#gadf6af5b31627428453d3136289091871" title="Count elements stored in the BST.">u_bst_count</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290     dbg_return_if (bst == NULL, (ssize_t) -1);
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="keywordflow">if</span> (bst-&gt;root == NULL)
<a name="l00293"></a>00293         <span class="keywordflow">return</span> 0;
<a name="l00294"></a>00294 
<a name="l00295"></a>00295     <span class="keywordflow">return</span> bst-&gt;root-&gt;nelem;
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00312"></a><a class="code" href="group__bst.html#gaa8c7e7a5bf67c9ec82c768392e525292">00312</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#gaa8c7e7a5bf67c9ec82c768392e525292" title="In-order walk the BST invoking a function on each traversed node.">u_bst_foreach</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keywordtype">void</span> (*cb)(<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *, <span class="keywordtype">void</span> *), 
<a name="l00313"></a>00313         <span class="keywordtype">void</span> *cb_args)
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315     dbg_return_if (bst == NULL, ~0);
<a name="l00316"></a>00316     dbg_return_if (cb == NULL, ~0);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     u_bst_node_foreach(bst-&gt;root, cb, cb_args);
<a name="l00319"></a>00319 
<a name="l00320"></a>00320     <span class="keywordflow">return</span> 0;
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00334"></a><a class="code" href="group__bst.html#ga79ec8187540662928d1c93e0fde7dd55">00334</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#ga79ec8187540662928d1c93e0fde7dd55" title="Re-balance a BST internal structure.">u_bst_balance</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst)
<a name="l00335"></a>00335 {
<a name="l00336"></a>00336     dbg_return_if (bst == NULL, ~0);
<a name="l00337"></a>00337 
<a name="l00338"></a>00338     bst-&gt;root = u_bst_node_balance(bst-&gt;root);
<a name="l00339"></a>00339 
<a name="l00340"></a>00340     <span class="keywordflow">return</span> 0;
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00355"></a><a class="code" href="group__bst.html#ga29a43c0cf556bc1daa2360390bc15940">00355</a> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *<a class="code" href="group__bst.html#ga29a43c0cf556bc1daa2360390bc15940" title="Do left/right rotation of the BST around a given pivot node.">u_bst_rotate</a> (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *pivot, <a class="code" href="group__bst.html#ga9c9fe984d47efc2954ac6217f445f65d" title="BST rotation types.">u_bst_rot_t</a> dir)
<a name="l00356"></a>00356 {
<a name="l00357"></a>00357     <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *newroot;    <span class="comment">/* It will become the new parent node. */</span>
<a name="l00358"></a>00358 
<a name="l00359"></a>00359     dbg_return_if (pivot == NULL, NULL);
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     <span class="keywordflow">switch</span> (dir)
<a name="l00362"></a>00362     {
<a name="l00363"></a>00363         <span class="comment">/* Promote the right child. */</span>
<a name="l00364"></a>00364         <span class="keywordflow">case</span> <a class="code" href="group__bst.html#gga9c9fe984d47efc2954ac6217f445f65daa134bd2564a6bc84a94e96af828a3f67">U_BST_ROT_LEFT</a>:
<a name="l00365"></a>00365             newroot = pivot-&gt;right;
<a name="l00366"></a>00366             pivot-&gt;right = newroot-&gt;left;
<a name="l00367"></a>00367             newroot-&gt;left = pivot;
<a name="l00368"></a>00368             <span class="comment">/* Update child nodes&#39; counters. */</span>
<a name="l00369"></a>00369             newroot-&gt;nelem = pivot-&gt;nelem;
<a name="l00370"></a>00370             pivot-&gt;nelem -= (newroot-&gt;right ? newroot-&gt;right-&gt;nelem + 1 : 1);
<a name="l00371"></a>00371             <span class="keywordflow">break</span>;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373         <span class="comment">/* Promote the left child. */</span>
<a name="l00374"></a>00374         <span class="keywordflow">case</span> <a class="code" href="group__bst.html#gga9c9fe984d47efc2954ac6217f445f65da71c6f0cde5b7fc6c575a721fb686a3f1">U_BST_ROT_RIGHT</a>:
<a name="l00375"></a>00375             newroot = pivot-&gt;left;
<a name="l00376"></a>00376             pivot-&gt;left = newroot-&gt;right;
<a name="l00377"></a>00377             newroot-&gt;right = pivot;
<a name="l00378"></a>00378             <span class="comment">/* Update child nodes&#39; counters. */</span>
<a name="l00379"></a>00379             newroot-&gt;nelem = pivot-&gt;nelem;
<a name="l00380"></a>00380             pivot-&gt;nelem -= (newroot-&gt;left ? newroot-&gt;left-&gt;nelem + 1 : 1);
<a name="l00381"></a>00381             <span class="keywordflow">break</span>;
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383 
<a name="l00384"></a>00384     <span class="keywordflow">return</span> newroot;
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00400"></a><a class="code" href="group__bst.html#gabb78e391e8be9e3b3083f132efbe53e4">00400</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#gabb78e391e8be9e3b3083f132efbe53e4" title="Set custom key attributes on the supplied BST.">u_bst_set_keyattr</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga346c18f1f674e1e05bdef8d77ea85799" title="Available types for BST containers.">u_bst_type_t</a> kt, <span class="keywordtype">size_t</span> ks)
<a name="l00401"></a>00401 {
<a name="l00402"></a>00402     dbg_return_if (bst == NULL, ~0);
<a name="l00403"></a>00403     dbg_return_if (kt == <a class="code" href="group__bst.html#gga346c18f1f674e1e05bdef8d77ea85799a4757c5b49062a205f5d50565eb442e15">U_BST_TYPE_OPAQUE</a> &amp;&amp; ks == 0, ~0);
<a name="l00404"></a>00404 
<a name="l00405"></a>00405     bst-&gt;keytype = kt;
<a name="l00406"></a>00406     bst-&gt;keysize = ks;
<a name="l00407"></a>00407 
<a name="l00408"></a>00408     <span class="keywordflow">if</span> (kt == <a class="code" href="group__bst.html#gga346c18f1f674e1e05bdef8d77ea85799a4757c5b49062a205f5d50565eb442e15">U_BST_TYPE_OPAQUE</a>)
<a name="l00409"></a>00409         bst-&gt;keyfree = u_bst_genfree;
<a name="l00410"></a>00410 
<a name="l00411"></a>00411     <span class="keywordflow">return</span> 0;
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00427"></a><a class="code" href="group__bst.html#ga97328590861246ab0d126d74d3519b27">00427</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#ga97328590861246ab0d126d74d3519b27" title="Set custom value attributes on the supplied BST.">u_bst_set_valattr</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga346c18f1f674e1e05bdef8d77ea85799" title="Available types for BST containers.">u_bst_type_t</a> vt, <span class="keywordtype">size_t</span> vs)
<a name="l00428"></a>00428 {
<a name="l00429"></a>00429     dbg_return_if (bst == NULL, ~0);
<a name="l00430"></a>00430     dbg_return_if (vt == <a class="code" href="group__bst.html#gga346c18f1f674e1e05bdef8d77ea85799a4757c5b49062a205f5d50565eb442e15">U_BST_TYPE_OPAQUE</a> &amp;&amp; vs == 0, ~0);
<a name="l00431"></a>00431 
<a name="l00432"></a>00432     bst-&gt;valtype = vt;
<a name="l00433"></a>00433     bst-&gt;valsize = vs;
<a name="l00434"></a>00434 
<a name="l00435"></a>00435     <span class="keywordflow">if</span> (vt == <a class="code" href="group__bst.html#gga346c18f1f674e1e05bdef8d77ea85799a4757c5b49062a205f5d50565eb442e15">U_BST_TYPE_OPAQUE</a>)
<a name="l00436"></a>00436         bst-&gt;valfree = u_bst_genfree;
<a name="l00437"></a>00437 
<a name="l00438"></a>00438     <span class="keywordflow">return</span> 0;
<a name="l00439"></a>00439 }
<a name="l00440"></a>00440 
<a name="l00452"></a><a class="code" href="group__bst.html#ga26111a34c158d3b28b84e0db068dce2b">00452</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#ga26111a34c158d3b28b84e0db068dce2b" title="Set custom key comparison function.">u_bst_set_cmp</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keywordtype">int</span> (*f)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *))
<a name="l00453"></a>00453 {
<a name="l00454"></a>00454     dbg_return_if (bst == NULL, ~0);
<a name="l00455"></a>00455     dbg_return_if (f == NULL, ~0);
<a name="l00456"></a>00456 
<a name="l00457"></a>00457     bst-&gt;cmp = f;
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="keywordflow">return</span> 0;
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00473"></a><a class="code" href="group__bst.html#ga9850b5f314c36452a3154a410503d79a">00473</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#ga9850b5f314c36452a3154a410503d79a" title="Set custom key free function.">u_bst_set_keyfree</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keywordtype">void</span> (*f)(<span class="keywordtype">void</span> *))
<a name="l00474"></a>00474 {
<a name="l00475"></a>00475     dbg_return_if (bst == NULL, ~0);
<a name="l00476"></a>00476     dbg_return_if (f == NULL, ~0);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478     bst-&gt;keyfree = f;
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <span class="keywordflow">return</span> 0;
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 
<a name="l00494"></a><a class="code" href="group__bst.html#ga3e59cc52f0ca28335084a7071d52907b">00494</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#ga3e59cc52f0ca28335084a7071d52907b" title="Set custom value free function.">u_bst_set_valfree</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keywordtype">void</span> (*f)(<span class="keywordtype">void</span> *))
<a name="l00495"></a>00495 {
<a name="l00496"></a>00496     dbg_return_if (bst == NULL, ~0);
<a name="l00497"></a>00497     dbg_return_if (f == NULL, ~0);
<a name="l00498"></a>00498 
<a name="l00499"></a>00499     bst-&gt;valfree = f;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501     <span class="keywordflow">return</span> 0;
<a name="l00502"></a>00502 }
<a name="l00503"></a>00503 
<a name="l00513"></a><a class="code" href="group__bst.html#ga11200059f62bd6e51bce012b61a656d4">00513</a> <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="group__bst.html#ga11200059f62bd6e51bce012b61a656d4" title="Node&amp;#39;s key getter.">u_bst_node_key</a> (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node)
<a name="l00514"></a>00514 {
<a name="l00515"></a>00515     dbg_return_if (node == NULL, NULL);
<a name="l00516"></a>00516 
<a name="l00517"></a>00517     <span class="keywordflow">return</span> node-&gt;key;
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00529"></a><a class="code" href="group__bst.html#ga500b4479db43bcd27f9c9b0c97095f18">00529</a> <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="group__bst.html#ga500b4479db43bcd27f9c9b0c97095f18" title="Node&amp;#39;s value getter.">u_bst_node_val</a> (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node)
<a name="l00530"></a>00530 {
<a name="l00531"></a>00531     dbg_return_if (node == NULL, NULL);
<a name="l00532"></a>00532 
<a name="l00533"></a>00533     <span class="keywordflow">return</span> node-&gt;val;
<a name="l00534"></a>00534 }
<a name="l00535"></a>00535 
<a name="l00545"></a><a class="code" href="group__bst.html#ga93c654ed77b737752a442c58b6149f8c">00545</a> ssize_t <a class="code" href="group__bst.html#ga93c654ed77b737752a442c58b6149f8c" title="Return the number of elements in the subtree rooted at node.">u_bst_node_count</a> (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node)
<a name="l00546"></a>00546 {
<a name="l00547"></a>00547     dbg_return_if (node == NULL, -1);
<a name="l00548"></a>00548 
<a name="l00549"></a>00549     <span class="keywordflow">return</span> node-&gt;nelem;
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00561"></a><a class="code" href="group__bst.html#ga0bba1afb40ccb7c63b78c893c6b31871">00561</a> <span class="keywordtype">int</span> <a class="code" href="group__bst.html#ga0bba1afb40ccb7c63b78c893c6b31871" title="Tell if the supplied BST is empty.">u_bst_empty</a> (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst)
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563     dbg_return_if (bst == NULL, 1); 
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     <span class="keywordflow">return</span> (bst-&gt;root == NULL);
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00572"></a>00572 <span class="keyword">static</span> <span class="keywordtype">int</span> u_bst_node_new (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *val, 
<a name="l00573"></a>00573         <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> **pnode)
<a name="l00574"></a>00574 {
<a name="l00575"></a>00575     <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node = NULL;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577     dbg_return_if (bst == NULL, ~0);
<a name="l00578"></a>00578     dbg_return_if (pnode == NULL, ~0);
<a name="l00579"></a>00579     dbg_return_if (key == NULL, ~0);
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     warn_err_sif ((node = <a class="code" href="group__alloc.html#gad508e24d765a79bd7e15feade062407c" title="Alloc a contiguous region of sz bytes and zero-fill it.">u_zalloc</a>(<span class="keyword">sizeof</span> *node)) == NULL);
<a name="l00582"></a>00582 
<a name="l00583"></a>00583     warn_err_if (u_bst_assign(&amp;node-&gt;key, key, bst-&gt;keytype, bst-&gt;keysize));
<a name="l00584"></a>00584     warn_err_if (u_bst_assign(&amp;node-&gt;val, val, bst-&gt;valtype, bst-&gt;valsize));
<a name="l00585"></a>00585 
<a name="l00586"></a>00586     node-&gt;right = node-&gt;left = NULL;
<a name="l00587"></a>00587     node-&gt;nelem = 1;    <span class="comment">/* Count itself. */</span>
<a name="l00588"></a>00588 
<a name="l00589"></a>00589     *pnode = node;
<a name="l00590"></a>00590 
<a name="l00591"></a>00591     <span class="keywordflow">return</span> 0;
<a name="l00592"></a>00592 err:
<a name="l00593"></a>00593     u_bst_node_do_free(bst, node);
<a name="l00594"></a>00594     <span class="keywordflow">return</span> ~0;
<a name="l00595"></a>00595 }
<a name="l00596"></a>00596 
<a name="l00597"></a>00597 <span class="keyword">static</span> <span class="keywordtype">void</span> u_bst_node_free (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node)
<a name="l00598"></a>00598 {
<a name="l00599"></a>00599     <span class="keywordflow">if</span> (node == NULL)
<a name="l00600"></a>00600         <span class="keywordflow">return</span>;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602     <span class="comment">/* Recursively free all child nodes (post-order). */</span>
<a name="l00603"></a>00603     u_bst_node_free(bst, node-&gt;left);
<a name="l00604"></a>00604     u_bst_node_free(bst, node-&gt;right);
<a name="l00605"></a>00605     u_bst_node_do_free(bst, node);
<a name="l00606"></a>00606 
<a name="l00607"></a>00607     <span class="keywordflow">return</span>;
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 <span class="keyword">static</span> <span class="keywordtype">void</span> u_bst_node_do_free (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node)
<a name="l00611"></a>00611 {
<a name="l00612"></a>00612     warn_return_if (bst == NULL, );
<a name="l00613"></a>00613 
<a name="l00614"></a>00614     <span class="keywordflow">if</span> (node == NULL)
<a name="l00615"></a>00615         <span class="keywordflow">return</span>;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617     <span class="keywordflow">if</span> (bst-&gt;keyfree &amp;&amp; node-&gt;key) 
<a name="l00618"></a>00618         bst-&gt;keyfree(node-&gt;key);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (bst-&gt;valfree &amp;&amp; node-&gt;val) 
<a name="l00621"></a>00621         bst-&gt;valfree(node-&gt;val);
<a name="l00622"></a>00622 
<a name="l00623"></a>00623     <a class="code" href="group__alloc.html#ga8a480341289bf5fc1a72e7974c4a739d" title="Wrapper for free-like function, sanity checks the supplied pointer.">u_free</a>(node);
<a name="l00624"></a>00624 
<a name="l00625"></a>00625     <span class="keywordflow">return</span>;
<a name="l00626"></a>00626 }
<a name="l00627"></a>00627 
<a name="l00628"></a>00628 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_search (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, <span class="keyword">const</span> <span class="keywordtype">void</span> *key, 
<a name="l00629"></a>00629         <span class="keywordtype">int</span> (*cmp)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *))
<a name="l00630"></a>00630 {
<a name="l00631"></a>00631     <span class="keywordtype">int</span> rc;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633     dbg_return_if (cmp == NULL, NULL);
<a name="l00634"></a>00634     dbg_return_if (key == NULL, NULL);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636     <span class="comment">/* We&#39;ve reached an external node: the quest ends here. */</span>
<a name="l00637"></a>00637     <span class="keywordflow">if</span> (node == NULL)
<a name="l00638"></a>00638         <span class="keywordflow">return</span> NULL;
<a name="l00639"></a>00639 
<a name="l00640"></a>00640     <span class="comment">/* If keys match, we&#39;re done. */</span>
<a name="l00641"></a>00641     <span class="keywordflow">if</span> ((rc = cmp(key, node-&gt;key)) == 0)
<a name="l00642"></a>00642         <span class="keywordflow">return</span> node;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <span class="comment">/* Searched key is greater: recur into the right subtree. */</span>
<a name="l00645"></a>00645     <span class="keywordflow">if</span> (rc &gt; 0)
<a name="l00646"></a>00646         <span class="keywordflow">return</span> u_bst_node_search(node-&gt;right, key, cmp);
<a name="l00647"></a>00647 
<a name="l00648"></a>00648     <span class="comment">/* The searched key is smaller, go left. */</span>
<a name="l00649"></a>00649     <span class="keywordflow">return</span> u_bst_node_search(node-&gt;left, key, cmp);
<a name="l00650"></a>00650 }
<a name="l00651"></a>00651 
<a name="l00652"></a>00652 <span class="keyword">static</span> <span class="keywordtype">int</span> u_bst_assign (<span class="keywordtype">void</span> **pdst, <span class="keyword">const</span> <span class="keywordtype">void</span> *src, <a class="code" href="group__bst.html#ga346c18f1f674e1e05bdef8d77ea85799" title="Available types for BST containers.">u_bst_type_t</a> t, 
<a name="l00653"></a>00653         <span class="keywordtype">size_t</span> sz)
<a name="l00654"></a>00654 {
<a name="l00655"></a>00655     dbg_return_if (pdst == NULL, ~0);
<a name="l00656"></a>00656 
<a name="l00657"></a>00657     <span class="keywordflow">switch</span> (t)
<a name="l00658"></a>00658     {
<a name="l00659"></a>00659         <span class="keywordflow">case</span> <a class="code" href="group__bst.html#gga346c18f1f674e1e05bdef8d77ea85799a8b7147090840d0f9591334943471021d">U_BST_TYPE_STRING</a>:
<a name="l00660"></a>00660             warn_err_sif (src &amp;&amp; (*pdst = <a class="code" href="group__misc.html#gae52a8784cc2099cbe1d700557daec2a6" title="Allocate sufficient memory for a copy of the supplied string, copy it, and return...">u_strdup</a>(src)) == NULL);
<a name="l00661"></a>00661             <span class="keywordflow">break</span>;
<a name="l00662"></a>00662         <span class="keywordflow">case</span> <a class="code" href="group__bst.html#gga346c18f1f674e1e05bdef8d77ea85799a4757c5b49062a205f5d50565eb442e15">U_BST_TYPE_OPAQUE</a>:
<a name="l00663"></a>00663             <span class="keywordflow">if</span> (src)
<a name="l00664"></a>00664             {
<a name="l00665"></a>00665                 warn_err_ifm (sz == 0, <span class="stringliteral">&quot;0-len opaque type !&quot;</span>);
<a name="l00666"></a>00666                 warn_err_sif ((*pdst = <a class="code" href="group__alloc.html#gab61921b41f57b91c825ef811200e8577" title="Wrapper for malloc-like function.">u_malloc</a>(sz)) == NULL);
<a name="l00667"></a>00667                 memcpy(*pdst, src, sz);
<a name="l00668"></a>00668             }
<a name="l00669"></a>00669             <span class="keywordflow">break</span>;
<a name="l00670"></a>00670         <span class="keywordflow">case</span> <a class="code" href="group__bst.html#gga346c18f1f674e1e05bdef8d77ea85799ab77c08797b87f64eaf0c5f6e92d71daf">U_BST_TYPE_PTR</a>:
<a name="l00671"></a>00671             memcpy(pdst, &amp;src, <span class="keyword">sizeof</span>(<span class="keywordtype">void</span> **));
<a name="l00672"></a>00672             <span class="keywordflow">break</span>;
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <span class="keywordflow">return</span> 0;
<a name="l00676"></a>00676 err:
<a name="l00677"></a>00677     <span class="keywordflow">return</span> ~0;
<a name="l00678"></a>00678 }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680 <span class="comment">/* Do in-order tree traversal.  Note that this provides a &quot;natural&quot; sort </span>
<a name="l00681"></a>00681 <span class="comment"> * of BST elements. </span>
<a name="l00682"></a>00682 <span class="comment"> * TODO: give a way to break the walk ? */</span>
<a name="l00683"></a>00683 <span class="keyword">static</span> <span class="keywordtype">void</span> u_bst_node_foreach (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, 
<a name="l00684"></a>00684         <span class="keywordtype">void</span> (*cb)(<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *, <span class="keywordtype">void</span> *), <span class="keywordtype">void</span> *cb_args)
<a name="l00685"></a>00685 {
<a name="l00686"></a>00686     <span class="keywordflow">if</span> (node == NULL)
<a name="l00687"></a>00687         <span class="keywordflow">return</span>;
<a name="l00688"></a>00688 
<a name="l00689"></a>00689     u_bst_node_foreach(node-&gt;left, cb, cb_args);
<a name="l00690"></a>00690     cb(node, cb_args);
<a name="l00691"></a>00691     u_bst_node_foreach(node-&gt;right, cb, cb_args);
<a name="l00692"></a>00692 
<a name="l00693"></a>00693     <span class="keywordflow">return</span>;
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_push_rand (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, 
<a name="l00697"></a>00697         <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *val)
<a name="l00698"></a>00698 {
<a name="l00699"></a>00699     dbg_return_if (bst == NULL, NULL);
<a name="l00700"></a>00700     dbg_return_if (key == NULL, NULL);
<a name="l00701"></a>00701 
<a name="l00702"></a>00702     <span class="keywordflow">if</span> (node == NULL)
<a name="l00703"></a>00703     {
<a name="l00704"></a>00704         warn_err_if (u_bst_node_new(bst, key, val, &amp;node));
<a name="l00705"></a>00705         <span class="keywordflow">return</span> node;
<a name="l00706"></a>00706     }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708     <span class="comment">/* The new node is inserted on the top with 1/nelem+1 probability. */</span>
<a name="l00709"></a>00709     <span class="keywordflow">if</span> ((<span class="keywordtype">size_t</span>) rand() &lt; RAND_MAX / (node-&gt;nelem + 1))
<a name="l00710"></a>00710         <span class="keywordflow">return</span> u_bst_node_push_top(bst, node, key, val);
<a name="l00711"></a>00711 
<a name="l00712"></a>00712     <span class="keywordflow">if</span> (bst-&gt;cmp(key, node-&gt;key) &lt; 0)
<a name="l00713"></a>00713         node-&gt;left = u_bst_node_push(bst, node-&gt;left, key, val);
<a name="l00714"></a>00714     <span class="keywordflow">else</span>
<a name="l00715"></a>00715         node-&gt;right = u_bst_node_push(bst, node-&gt;right, key, val);
<a name="l00716"></a>00716 
<a name="l00717"></a>00717     node-&gt;nelem += 1;
<a name="l00718"></a>00718 
<a name="l00719"></a>00719     <span class="keywordflow">return</span> node;
<a name="l00720"></a>00720 err:
<a name="l00721"></a>00721     <span class="keywordflow">return</span> NULL;
<a name="l00722"></a>00722 }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_push (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, 
<a name="l00725"></a>00725         <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *val)
<a name="l00726"></a>00726 {
<a name="l00727"></a>00727     dbg_return_if (bst == NULL, NULL);
<a name="l00728"></a>00728     dbg_return_if (key == NULL, NULL);
<a name="l00729"></a>00729 
<a name="l00730"></a>00730     <span class="keywordflow">if</span> (node == NULL)
<a name="l00731"></a>00731     {
<a name="l00732"></a>00732         warn_err_if (u_bst_node_new(bst, key, val, &amp;node));
<a name="l00733"></a>00733         <span class="keywordflow">return</span> node;
<a name="l00734"></a>00734     }
<a name="l00735"></a>00735 
<a name="l00736"></a>00736     <span class="keywordflow">if</span> (bst-&gt;cmp(key, node-&gt;key) &lt; 0)
<a name="l00737"></a>00737         node-&gt;left = u_bst_node_push(bst, node-&gt;left, key, val);
<a name="l00738"></a>00738     <span class="keywordflow">else</span>
<a name="l00739"></a>00739         node-&gt;right = u_bst_node_push(bst, node-&gt;right, key, val);
<a name="l00740"></a>00740 
<a name="l00741"></a>00741     node-&gt;nelem += 1;
<a name="l00742"></a>00742 
<a name="l00743"></a>00743     <span class="keywordflow">return</span> node;
<a name="l00744"></a>00744 err:
<a name="l00745"></a>00745     <span class="keywordflow">return</span> NULL;
<a name="l00746"></a>00746 }
<a name="l00747"></a>00747  
<a name="l00748"></a>00748 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_push_bottom (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <span class="keyword">const</span> <span class="keywordtype">void</span> *key, 
<a name="l00749"></a>00749         <span class="keyword">const</span> <span class="keywordtype">void</span> *val)
<a name="l00750"></a>00750 {
<a name="l00751"></a>00751     <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *parent, *node;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753     dbg_return_if (bst == NULL, NULL);
<a name="l00754"></a>00754     dbg_return_if (key == NULL, NULL);
<a name="l00755"></a>00755 
<a name="l00756"></a>00756     <span class="comment">/* Empty BST, handle special case. */</span>
<a name="l00757"></a>00757     <span class="keywordflow">if</span> (<a class="code" href="group__bst.html#ga0bba1afb40ccb7c63b78c893c6b31871" title="Tell if the supplied BST is empty.">u_bst_empty</a>(bst))
<a name="l00758"></a>00758     {
<a name="l00759"></a>00759         warn_err_if (u_bst_node_new(bst, key, val, &amp;bst-&gt;root));
<a name="l00760"></a>00760         <span class="keywordflow">return</span> bst-&gt;root;
<a name="l00761"></a>00761     }
<a name="l00762"></a>00762 
<a name="l00763"></a>00763     <span class="comment">/* Find a way through the non-empty BST until we reach an external node. */</span>
<a name="l00764"></a>00764     <span class="keywordflow">for</span> (node = bst-&gt;root;
<a name="l00765"></a>00765             node != NULL;
<a name="l00766"></a>00766             node = (bst-&gt;cmp(key, node-&gt;key) &lt; 0) ? node-&gt;left : node-&gt;right)
<a name="l00767"></a>00767     {
<a name="l00768"></a>00768         <span class="comment">/* Save parent reference.  It is needed later, on loop exhaustion, to </span>
<a name="l00769"></a>00769 <span class="comment">         * fix left/child links of the node to which we attach. */</span>
<a name="l00770"></a>00770         parent = node;
<a name="l00771"></a>00771 
<a name="l00772"></a>00772         <span class="comment">/* Increment children counter of each node while we traverse. */</span>
<a name="l00773"></a>00773         node-&gt;nelem += 1;
<a name="l00774"></a>00774     }
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="comment">/* Create a new node with the supplied (key, val). */</span>
<a name="l00777"></a>00777     warn_err_if (u_bst_node_new(bst, key, val, &amp;node));
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     <span class="comment">/* Choose the subtree to which it belongs. */</span>
<a name="l00780"></a>00780     <span class="keywordflow">if</span> (bst-&gt;cmp(key, parent-&gt;key) &lt; 0)
<a name="l00781"></a>00781         parent-&gt;left = node;
<a name="l00782"></a>00782     <span class="keywordflow">else</span>
<a name="l00783"></a>00783         parent-&gt;right = node;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785     <span class="keywordflow">return</span> bst-&gt;root;
<a name="l00786"></a>00786 err:
<a name="l00787"></a>00787     <span class="keywordflow">return</span> NULL;
<a name="l00788"></a>00788 }
<a name="l00789"></a>00789 
<a name="l00790"></a>00790 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_push_top (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, 
<a name="l00791"></a>00791         <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keyword">const</span> <span class="keywordtype">void</span> *val)
<a name="l00792"></a>00792 {
<a name="l00793"></a>00793     <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *newnode = NULL;
<a name="l00794"></a>00794 
<a name="l00795"></a>00795     dbg_return_if (bst == NULL, NULL);
<a name="l00796"></a>00796     dbg_return_if (key == NULL, NULL);
<a name="l00797"></a>00797 
<a name="l00798"></a>00798     <span class="comment">/* External node reached: create the node. */</span>
<a name="l00799"></a>00799     <span class="keywordflow">if</span> (node == NULL)
<a name="l00800"></a>00800     {
<a name="l00801"></a>00801         warn_err_if (u_bst_node_new(bst, key, val, &amp;newnode));
<a name="l00802"></a>00802         <span class="keywordflow">return</span> newnode;
<a name="l00803"></a>00803     }
<a name="l00804"></a>00804 
<a name="l00805"></a>00805     <span class="comment">/* Update child counter of the traversed node. */</span>
<a name="l00806"></a>00806     node-&gt;nelem += 1;
<a name="l00807"></a>00807 
<a name="l00808"></a>00808     <span class="comment">/* Let the created node bubble up through subsequent rotations. */</span>
<a name="l00809"></a>00809     <span class="keywordflow">if</span> (bst-&gt;cmp(key, node-&gt;key) &lt; 0)
<a name="l00810"></a>00810     {
<a name="l00811"></a>00811         node-&gt;left = u_bst_node_push_top(bst, node-&gt;left, key, val);
<a name="l00812"></a>00812         node = <a class="code" href="group__bst.html#ga29a43c0cf556bc1daa2360390bc15940" title="Do left/right rotation of the BST around a given pivot node.">u_bst_rotate</a>(node, <a class="code" href="group__bst.html#gga9c9fe984d47efc2954ac6217f445f65da71c6f0cde5b7fc6c575a721fb686a3f1">U_BST_ROT_RIGHT</a>);
<a name="l00813"></a>00813     }
<a name="l00814"></a>00814     <span class="keywordflow">else</span>
<a name="l00815"></a>00815     {
<a name="l00816"></a>00816         node-&gt;right = u_bst_node_push_top(bst, node-&gt;right, key, val);
<a name="l00817"></a>00817         node = <a class="code" href="group__bst.html#ga29a43c0cf556bc1daa2360390bc15940" title="Do left/right rotation of the BST around a given pivot node.">u_bst_rotate</a>(node, <a class="code" href="group__bst.html#gga9c9fe984d47efc2954ac6217f445f65daa134bd2564a6bc84a94e96af828a3f67">U_BST_ROT_LEFT</a>);
<a name="l00818"></a>00818     }
<a name="l00819"></a>00819     
<a name="l00820"></a>00820     <span class="keywordflow">return</span> node;
<a name="l00821"></a>00821 err:
<a name="l00822"></a>00822     <span class="keywordflow">return</span> NULL;
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824 
<a name="l00825"></a>00825 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_promote_nth (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, <span class="keywordtype">size_t</span> n)
<a name="l00826"></a>00826 {
<a name="l00827"></a>00827     <span class="keywordtype">size_t</span> t;
<a name="l00828"></a>00828     
<a name="l00829"></a>00829     dbg_return_if (node == NULL, NULL);
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     t = (node-&gt;left == NULL) ? 0 : node-&gt;left-&gt;nelem;
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     if (t &gt; n)
<a name="l00834"></a>00834     {
<a name="l00835"></a>00835         node-&gt;left = u_bst_node_promote_nth(node-&gt;left, n);
<a name="l00836"></a>00836         node = <a class="code" href="group__bst.html#ga29a43c0cf556bc1daa2360390bc15940" title="Do left/right rotation of the BST around a given pivot node.">u_bst_rotate</a>(node, <a class="code" href="group__bst.html#gga9c9fe984d47efc2954ac6217f445f65da71c6f0cde5b7fc6c575a721fb686a3f1">U_BST_ROT_RIGHT</a>);
<a name="l00837"></a>00837     }
<a name="l00838"></a>00838 
<a name="l00839"></a>00839     <span class="keywordflow">if</span> (t &lt; n)
<a name="l00840"></a>00840     {
<a name="l00841"></a>00841         node-&gt;right = u_bst_node_promote_nth(node-&gt;right, n - (t + 1));
<a name="l00842"></a>00842         node = <a class="code" href="group__bst.html#ga29a43c0cf556bc1daa2360390bc15940" title="Do left/right rotation of the BST around a given pivot node.">u_bst_rotate</a>(node, <a class="code" href="group__bst.html#gga9c9fe984d47efc2954ac6217f445f65daa134bd2564a6bc84a94e96af828a3f67">U_BST_ROT_LEFT</a>);
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844 
<a name="l00845"></a>00845     <span class="keywordflow">return</span> node;
<a name="l00846"></a>00846 }
<a name="l00847"></a>00847 
<a name="l00848"></a>00848 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_join_lr (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *l, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *r)
<a name="l00849"></a>00849 {
<a name="l00850"></a>00850     <span class="keywordflow">if</span> (r == NULL)
<a name="l00851"></a>00851         <span class="keywordflow">return</span> l;
<a name="l00852"></a>00852 
<a name="l00853"></a>00853     <span class="comment">/* Make the smallest node in the right subtree the new BST root. */</span>
<a name="l00854"></a>00854     r = u_bst_node_promote_nth(r, 0);
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     <span class="comment">/* Let the left subtree become the left child of the new root. */</span>
<a name="l00857"></a>00857     r-&gt;left = l;
<a name="l00858"></a>00858 
<a name="l00859"></a>00859     <span class="keywordflow">return</span> r;
<a name="l00860"></a>00860 }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_delete (<a class="code" href="group__bst.html#ga95f26d49792d789d9ad751dbe4d1af2e" title="The binary search tree type.">u_bst_t</a> *bst, <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, 
<a name="l00863"></a>00863         <span class="keyword">const</span> <span class="keywordtype">void</span> *key, <span class="keywordtype">int</span> *pfound)
<a name="l00864"></a>00864 {
<a name="l00865"></a>00865     <span class="keywordtype">int</span> rc;
<a name="l00866"></a>00866     <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *delnode;
<a name="l00867"></a>00867 
<a name="l00868"></a>00868     <span class="keywordflow">if</span> (node == NULL)
<a name="l00869"></a>00869         <span class="keywordflow">return</span> NULL;
<a name="l00870"></a>00870 
<a name="l00871"></a>00871     <span class="comment">/* Search on the left subtree. */</span>
<a name="l00872"></a>00872     <span class="keywordflow">if</span> ((rc = bst-&gt;cmp(key, node-&gt;key)) &lt; 0)
<a name="l00873"></a>00873         node-&gt;left = u_bst_node_delete(bst, node-&gt;left, key, pfound);
<a name="l00874"></a>00874 
<a name="l00875"></a>00875     <span class="comment">/* Search on the right subtree. */</span>
<a name="l00876"></a>00876     <span class="keywordflow">if</span> (rc &gt; 0)
<a name="l00877"></a>00877         node-&gt;right = u_bst_node_delete(bst, node-&gt;right, key, pfound);
<a name="l00878"></a>00878 
<a name="l00879"></a>00879     <span class="comment">/* Found ! Evict it. */</span>
<a name="l00880"></a>00880     <span class="keywordflow">if</span> (rc == 0)
<a name="l00881"></a>00881     {
<a name="l00882"></a>00882         delnode = node;
<a name="l00883"></a>00883         node = u_bst_node_join_lr(node-&gt;left, node-&gt;right);
<a name="l00884"></a>00884         u_bst_node_do_free(bst, delnode);
<a name="l00885"></a>00885         *pfound = 1;
<a name="l00886"></a>00886     }
<a name="l00887"></a>00887 
<a name="l00888"></a>00888     <span class="comment">/* Update child nodes&#39; counter. */</span>
<a name="l00889"></a>00889     <span class="keywordflow">if</span> (node &amp;&amp; *pfound)
<a name="l00890"></a>00890         node-&gt;nelem -= 1;
<a name="l00891"></a>00891 
<a name="l00892"></a>00892     <span class="keywordflow">return</span> node;
<a name="l00893"></a>00893 }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_find_nth (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node, <span class="keywordtype">size_t</span> n)
<a name="l00896"></a>00896 {
<a name="l00897"></a>00897     <span class="keywordtype">size_t</span> t;
<a name="l00898"></a>00898 
<a name="l00899"></a>00899     <span class="keywordflow">if</span> (node == NULL)
<a name="l00900"></a>00900         <span class="keywordflow">return</span> NULL;
<a name="l00901"></a>00901 
<a name="l00902"></a>00902     <span class="comment">/* Store the number of elements in the left subtree. */</span>
<a name="l00903"></a>00903     t = (node-&gt;left == NULL) ? 0 : node-&gt;left-&gt;nelem;
<a name="l00904"></a>00904 
<a name="l00905"></a>00905     <span class="comment">/* If &#39;t&#39; is smaller than the searched index, the n-th node hides</span>
<a name="l00906"></a>00906 <span class="comment">     * in the left subtree. */</span>
<a name="l00907"></a>00907     if (t &gt; n)
<a name="l00908"></a>00908         <span class="keywordflow">return</span> u_bst_node_find_nth(node-&gt;left, n);   
<a name="l00909"></a>00909 
<a name="l00910"></a>00910     <span class="comment">/* If &#39;t&#39; is larger than the searched index, the n-th node hides</span>
<a name="l00911"></a>00911 <span class="comment">     * in the right subtree at index n-(t+1). */</span>
<a name="l00912"></a>00912     <span class="keywordflow">if</span> (t &lt; n)
<a name="l00913"></a>00913         <span class="keywordflow">return</span> u_bst_node_find_nth(node-&gt;right, n - (t + 1));
<a name="l00914"></a>00914 
<a name="l00915"></a>00915     <span class="keywordflow">return</span> node;    <span class="comment">/* Found ! */</span>
<a name="l00916"></a>00916 }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918 <span class="keyword">static</span> <a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *u_bst_node_balance (<a class="code" href="group__bst.html#ga06c39e816d8a81124bc91e2ef7d10c6c" title="The binary search tree node type.">u_bst_node_t</a> *node)
<a name="l00919"></a>00919 {
<a name="l00920"></a>00920     <span class="keywordflow">if</span> (node == NULL || node-&gt;nelem &lt; 2)
<a name="l00921"></a>00921         <span class="keywordflow">return</span> node;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="comment">/* Promote the median node to the BST root. */</span>
<a name="l00924"></a>00924     node = u_bst_node_promote_nth(node, node-&gt;nelem / 2);
<a name="l00925"></a>00925 
<a name="l00926"></a>00926     <span class="comment">/* Then go recursively into its subtrees. */</span>
<a name="l00927"></a>00927     node-&gt;left  = u_bst_node_balance(node-&gt;left);
<a name="l00928"></a>00928     node-&gt;right = u_bst_node_balance(node-&gt;right);
<a name="l00929"></a>00929 
<a name="l00930"></a>00930     <span class="keywordflow">return</span> node;
<a name="l00931"></a>00931 }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933 <span class="keyword">static</span> <span class="keywordtype">int</span> u_bst_keycmp (<span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b)
<a name="l00934"></a>00934 {
<a name="l00935"></a>00935     <span class="keywordflow">return</span> strcmp((<span class="keyword">const</span> <span class="keywordtype">char</span> *) a, (<span class="keyword">const</span> <span class="keywordtype">char</span> *) b);
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 
<a name="l00938"></a>00938 <span class="keyword">static</span> <span class="keywordtype">void</span> u_bst_genfree (<span class="keywordtype">void</span> *p) 
<a name="l00939"></a>00939 { 
<a name="l00940"></a>00940     <a class="code" href="group__alloc.html#ga8a480341289bf5fc1a72e7974c4a739d" title="Wrapper for free-like function, sanity checks the supplied pointer.">u_free</a>(p); 
<a name="l00941"></a>00941     <span class="keywordflow">return</span>;
<a name="l00942"></a>00942 }
<a name="l00943"></a>00943 
<a name="l00944"></a>00944 <span class="preprocessor">#ifdef BST_DEBUG</span>
<a name="l00945"></a>00945 <span class="preprocessor"></span><span class="keyword">static</span> <span class="keywordtype">int</span> u_bst_keycmp_dbg (<span class="keyword">const</span> <span class="keywordtype">void</span> *a, <span class="keyword">const</span> <span class="keywordtype">void</span> *b)
<a name="l00946"></a>00946 {
<a name="l00947"></a>00947     <span class="keywordtype">int</span> rc;
<a name="l00948"></a>00948     <span class="keyword">const</span> <span class="keywordtype">char</span> *x = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) a;
<a name="l00949"></a>00949     <span class="keyword">const</span> <span class="keywordtype">char</span> *y = (<span class="keyword">const</span> <span class="keywordtype">char</span> *) b;
<a name="l00950"></a>00950 
<a name="l00951"></a>00951     rc = strcmp(x, y);
<a name="l00952"></a>00952     u_con(<span class="stringliteral">&quot;%s %c %s&quot;</span>, x, (rc == 0) ? <span class="charliteral">&#39;=&#39;</span> : (rc &gt; 0) ? <span class="charliteral">&#39;&gt;&#39;</span> : <span class="charliteral">&#39;&lt;&#39;</span>, y);
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="keywordflow">return</span> rc;
<a name="l00955"></a>00955 }
<a name="l00956"></a>00956 <span class="preprocessor">#endif  </span><span class="comment">/* BST_DEBUG */</span>
</pre></div></div>
<hr>
<div>
  <div style="text-align:left">
    <a href="http://www.koanlogic.com/products.html">&larr;Products</a>
  </div>
  <div style="text-align:center;">
    &copy; 2005-2012 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
  </div>
</div>

</body>
</html>
