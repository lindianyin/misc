<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>LibU: Ring Buffer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Intro</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Ring Buffer</h1><hr/><a name="_details"></a><h2>Overview</h2>
<p>The <a class="el" href="group__rb.html">Ring Buffer</a> module provides a fast implementation of a circular buffer. Data can be written to (<a class="el" href="group__rb.html#ga502c54f19c503be57950769ca9b6601a" title="Write to the ring buffer.">u_rb_write</a>), or read (<a class="el" href="group__rb.html#ga7d02dec994d832f541552181c74db248" title="Read from the ring buffer.">u_rb_read</a>) from the buffer. When the buffer fills up (i.e. the reader is less efficient that the writer) any subsequent <a class="el" href="group__rb.html#ga502c54f19c503be57950769ca9b6601a" title="Write to the ring buffer.">u_rb_write</a> operation will fail until more space is made available either by an explicit reset of the buffer - which is done via <a class="el" href="group__rb.html#ga6812710d3f8a8be2e9077fcdd9dc9b9d" title="Reset the ring buffer.">u_rb_clear</a> - or by an <a class="el" href="group__rb.html#ga7d02dec994d832f541552181c74db248" title="Read from the ring buffer.">u_rb_read</a> operation. The <a class="el" href="group__rb.html#ga1c5a78cea7bd83d522445927ef36f703" title="Return the unused buffer space.">u_rb_avail</a> and <a class="el" href="group__rb.html#ga22a6662e68557d3141d01eb97f0128d5" title="Return the number of bytes ready to be consumed.">u_rb_ready</a> functions can be used by the writer and the reader respectively to test if their actions can be taken. Initialization: </p>
<div class="fragment"><pre class="fragment">    <span class="keywordtype">size_t</span> rb_sz, to_write, to_read;
    <a class="code" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> *rb = NULL;

    <span class="comment">// create a ring buffer of size (at least) 1024 bytes</span>
    dbg_err_if (<a class="code" href="group__rb.html#ga5f6b8d62ce4228bf6dbdc6940dccc8ac" title="Create a new ring buffer object.">u_rb_create</a>(1024, <a class="code" href="group__rb.html#gga230d72d2e2b2f19edfb9e211c8afbb7baec0ecf4ca55f8f262fef83d75685841c">U_RB_OPT_NONE</a>, &amp;rb));

    <span class="comment">// you can get the actual size of the buffer by using u_rb_size</span>
    con(<span class="stringliteral">&quot;ring buffer (@%p) of size %zu&quot;</span>, rb, (rb_sz = <a class="code" href="group__rb.html#gab957d383db17b16b4797f349cea3b896" title="Return the size of the ring buffer.">u_rb_size</a>(rb)));
</pre></div><p>The writer: </p>
<div class="fragment"><pre class="fragment">    <span class="comment">// assuming ibufp is an ideal, infinite size buffer :)</span>
    <span class="keywordflow">while</span> ((to_write = <a class="code" href="group__rb.html#ga1c5a78cea7bd83d522445927ef36f703" title="Return the unused buffer space.">u_rb_avail</a>(rb)) &gt; 0)
    {
        (void) <a class="code" href="group__rb.html#ga502c54f19c503be57950769ca9b6601a" title="Write to the ring buffer.">u_rb_write</a>(rb, ibufp, to_write);
        ibufp += to_write;
    }
</pre></div><p> The reader is actually the dual: </p>
<div class="fragment"><pre class="fragment">    <span class="comment">// assuming obufp is the same class as ibufp</span>
    <span class="keywordflow">while</span> ((to_read = <a class="code" href="group__rb.html#ga22a6662e68557d3141d01eb97f0128d5" title="Return the number of bytes ready to be consumed.">u_rb_ready</a>(rb)) &gt; 0)
    {
        (void) <a class="code" href="group__rb.html#ga7d02dec994d832f541552181c74db248" title="Read from the ring buffer.">u_rb_read</a>(rb, obufp, to_read);
        obufp += to_read;
    }
</pre></div><p>There exist two distinct implementation of the underlying machinery, one is malloc(3) based, the other is mmap(2) based. The latter is the default on platforms supporting the mmap syscall. Anyway, the user can choose to use the malloc implementation by supplying <a class="el" href="group__rb.html#gga230d72d2e2b2f19edfb9e211c8afbb7ba8a6d9d0bd2e2fc11a2e0f77529ffd29d">U_RB_OPT_IMPL_MALLOC</a> as an option parameter at creation time. The malloc implementation comes in two different flavours: one using a double-size buffer which enables the <a class="el" href="group__rb.html#ga8556e497a5f7cd608f6c4a489d7182f2" title="Read from the ring buffer with minimum overhead.">u_rb_fast_read</a> (no-copy) interface, the other using a buffer exactly the size requested by the user, but disallowing the "no-copy-read" interface (this is the default). The user can always enable the contiguous mode by supplying the <a class="el" href="group__rb.html#gga230d72d2e2b2f19edfb9e211c8afbb7ba29aea0fcb4274b01a094e17c58739760">U_RB_OPT_USE_CONTIGUOUS_MEM</a> as a <a class="el" href="group__rb.html#ga5f6b8d62ce4228bf6dbdc6940dccc8ac" title="Create a new ring buffer object.">u_rb_create</a> option.</p>
<dl class="note"><dt><b>Note:</b></dt><dd></dd></dl>
<ul>
<li>The <a class="el" href="group__rb.html">Ring Buffer</a> module is not thread safe: should you need to use it in a MT scenario, you'll have to wrap the <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> into a mutexed object and bound the relevant operations to the mutex acquisition.</li>
</ul>
<ul>
<li>A read interface which minimises overhead (<a class="el" href="group__rb.html#ga8556e497a5f7cd608f6c4a489d7182f2" title="Read from the ring buffer with minimum overhead.">u_rb_fast_read</a>) is enabled on <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> objects created with the <a class="el" href="group__rb.html#gga230d72d2e2b2f19edfb9e211c8afbb7ba29aea0fcb4274b01a094e17c58739760">U_RB_OPT_USE_CONTIGUOUS_MEM</a> flag set (the mmap implementation always uses the contiguous memory strategy). </li>
</ul>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaea2a7071b45141bf4dab0020f7adca18"></a><!-- doxytag: member="rb::u_rb_t" ref="gaea2a7071b45141bf4dab0020f7adca18" args="" -->
typedef struct u_rb_s&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The ring buffer type. <br/></td></tr>
<tr><td colspan="2"><h2>Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#ga230d72d2e2b2f19edfb9e211c8afbb7b">u_rb_opts_t</a> { <a class="el" href="group__rb.html#gga230d72d2e2b2f19edfb9e211c8afbb7baec0ecf4ca55f8f262fef83d75685841c">U_RB_OPT_NONE</a> =  0x00, 
<a class="el" href="group__rb.html#gga230d72d2e2b2f19edfb9e211c8afbb7ba29aea0fcb4274b01a094e17c58739760">U_RB_OPT_USE_CONTIGUOUS_MEM</a> =  0x01, 
<a class="el" href="group__rb.html#gga230d72d2e2b2f19edfb9e211c8afbb7ba8a6d9d0bd2e2fc11a2e0f77529ffd29d">U_RB_OPT_IMPL_MALLOC</a> =  0x02
 }</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight"><p>Options to tweak the ring buffer implementation. </p>
 <a href="group__rb.html#ga230d72d2e2b2f19edfb9e211c8afbb7b">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#ga5f6b8d62ce4228bf6dbdc6940dccc8ac">u_rb_create</a> (size_t hint_sz, int opts, <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> **prb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new ring buffer object.  <a href="#ga5f6b8d62ce4228bf6dbdc6940dccc8ac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#ga6812710d3f8a8be2e9077fcdd9dc9b9d">u_rb_clear</a> (<a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *rb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Reset the ring buffer.  <a href="#ga6812710d3f8a8be2e9077fcdd9dc9b9d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#ga132894d36be7982b808a7e0024866ffd">u_rb_free</a> (<a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *rb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Dispose a ring buffer object.  <a href="#ga132894d36be7982b808a7e0024866ffd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#gab957d383db17b16b4797f349cea3b896">u_rb_size</a> (<a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *rb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the size of the ring buffer.  <a href="#gab957d383db17b16b4797f349cea3b896"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ssize_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#ga7d02dec994d832f541552181c74db248">u_rb_read</a> (<a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *rb, void *b, size_t b_sz)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read from the ring buffer.  <a href="#ga7d02dec994d832f541552181c74db248"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#ga8556e497a5f7cd608f6c4a489d7182f2">u_rb_fast_read</a> (<a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *rb, size_t *pb_sz)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Read from the ring buffer with minimum overhead.  <a href="#ga8556e497a5f7cd608f6c4a489d7182f2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">ssize_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#ga502c54f19c503be57950769ca9b6601a">u_rb_write</a> (<a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *rb, const void *b, size_t b_sz)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write to the ring buffer.  <a href="#ga502c54f19c503be57950769ca9b6601a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#ga22a6662e68557d3141d01eb97f0128d5">u_rb_ready</a> (<a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *rb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the number of bytes ready to be consumed.  <a href="#ga22a6662e68557d3141d01eb97f0128d5"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__rb.html#ga1c5a78cea7bd83d522445927ef36f703">u_rb_avail</a> (<a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *rb)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the unused buffer space.  <a href="#ga1c5a78cea7bd83d522445927ef36f703"></a><br/></td></tr>
</table>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="ga230d72d2e2b2f19edfb9e211c8afbb7b"></a><!-- doxytag: member="rb.h::u_rb_opts_t" ref="ga230d72d2e2b2f19edfb9e211c8afbb7b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__rb.html#ga230d72d2e2b2f19edfb9e211c8afbb7b">u_rb_opts_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="gga230d72d2e2b2f19edfb9e211c8afbb7baec0ecf4ca55f8f262fef83d75685841c"></a><!-- doxytag: member="U_RB_OPT_NONE" ref="gga230d72d2e2b2f19edfb9e211c8afbb7baec0ecf4ca55f8f262fef83d75685841c" args="" -->U_RB_OPT_NONE</em>&nbsp;</td><td>
<p>use default (depending on platform) creation method </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga230d72d2e2b2f19edfb9e211c8afbb7ba29aea0fcb4274b01a094e17c58739760"></a><!-- doxytag: member="U_RB_OPT_USE_CONTIGUOUS_MEM" ref="gga230d72d2e2b2f19edfb9e211c8afbb7ba29aea0fcb4274b01a094e17c58739760" args="" -->U_RB_OPT_USE_CONTIGUOUS_MEM</em>&nbsp;</td><td>
<p>force implementation to use a contiguous memory buffer to store ringbuffer data. This option enables the <a class="el" href="group__rb.html#ga8556e497a5f7cd608f6c4a489d7182f2" title="Read from the ring buffer with minimum overhead.">u_rb_fast_read</a> interface. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="gga230d72d2e2b2f19edfb9e211c8afbb7ba8a6d9d0bd2e2fc11a2e0f77529ffd29d"></a><!-- doxytag: member="U_RB_OPT_IMPL_MALLOC" ref="gga230d72d2e2b2f19edfb9e211c8afbb7ba8a6d9d0bd2e2fc11a2e0f77529ffd29d" args="" -->U_RB_OPT_IMPL_MALLOC</em>&nbsp;</td><td>
<p>Force use of malloc(3) based implementation. The default is to use the mmap(2) implementation on platforms supporting it. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="rb_8h_source.html#l00032">32</a> of file <a class="el" href="rb_8h_source.html">rb.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga1c5a78cea7bd83d522445927ef36f703"></a><!-- doxytag: member="rb.h::u_rb_avail" ref="ga1c5a78cea7bd83d522445927ef36f703" args="(u_rb_t *rb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t u_rb_avail </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rb</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return number of unused bytes in the supplied <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object, i.e. the dual of <a class="el" href="group__rb.html#ga22a6662e68557d3141d01eb97f0128d5" title="Return the number of bytes ready to be consumed.">u_rb_ready</a>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rb</em>&nbsp;</td><td>reference to an already allocated <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of bytes that can be <a class="el" href="group__rb.html#ga502c54f19c503be57950769ca9b6601a" title="Write to the ring buffer.">u_rb_write</a>'d before old data starts being overwritten </dd></dl>

<p>Definition at line <a class="el" href="srcs_2toolbox_2rb_8c_source.html#l00330">330</a> of file <a class="el" href="srcs_2toolbox_2rb_8c_source.html">srcs/toolbox/rb.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga6812710d3f8a8be2e9077fcdd9dc9b9d"></a><!-- doxytag: member="rb.h::u_rb_clear" ref="ga6812710d3f8a8be2e9077fcdd9dc9b9d" args="(u_rb_t *rb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int u_rb_clear </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rb</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Reset read and write offset counters of the supplied <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object <code>rb</code> </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rb</em>&nbsp;</td><td>reference to an already allocated <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on failure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="srcs_2toolbox_2rb_8c_source.html#l00296">296</a> of file <a class="el" href="srcs_2toolbox_2rb_8c_source.html">srcs/toolbox/rb.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga5f6b8d62ce4228bf6dbdc6940dccc8ac"></a><!-- doxytag: member="rb.h::u_rb_create" ref="ga5f6b8d62ce4228bf6dbdc6940dccc8ac" args="(size_t hint_sz, int opts, u_rb_t **prb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int u_rb_create </td>
          <td>(</td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>hint_sz</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>opts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> **&nbsp;</td>
          <td class="paramname"> <em>prb</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Create a new <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object of size (at least) <code>hint_sz</code> and return it at <code>*prb</code>. The memory region used to hold the buffer is <code>mmap'd</code> and as such it has "page alignment" constraint which could make it space-inefficient in case a very tiny (i.e. much smaller than the system page size) ring buffer is needed. In fact, optimal size for a <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object is a multiple of the target system page size.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>hint_sz</em>&nbsp;</td><td>the suggested size in bytes for the ring buffer (the actual size could be more than that because of alignment needs) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>opts</em>&nbsp;</td><td>Bitwise inclusive OR of <a class="el" href="group__rb.html#ga230d72d2e2b2f19edfb9e211c8afbb7b" title="Options to tweak the ring buffer implementation.">u_rb_opts_t</a> values </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>prb</em>&nbsp;</td><td>result argument which holds the reference to the newly created <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object</td></tr>
  </table>
  </dd>
</dl>
<dl><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on error</td></tr>
  </table>
  </dd>
</dl>
<dl class="note"><dt><b>Note:</b></dt><dd>We try to use the mmap-based implementation whenever possible. </dd></dl>

<p>Definition at line <a class="el" href="srcs_2toolbox_2rb_8c_source.html#l00153">153</a> of file <a class="el" href="srcs_2toolbox_2rb_8c_source.html">srcs/toolbox/rb.c</a>.</p>

<p>References <a class="el" href="rb_8h_source.html#l00040">U_RB_OPT_IMPL_MALLOC</a>.</p>

</div>
</div>
<a class="anchor" id="ga8556e497a5f7cd608f6c4a489d7182f2"></a><!-- doxytag: member="rb.h::u_rb_fast_read" ref="ga8556e497a5f7cd608f6c4a489d7182f2" args="(u_rb_t *rb, size_t *pb_sz)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * u_rb_fast_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&nbsp;</td>
          <td class="paramname"> <em>pb_sz</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Try to read <code>*pb_sz</code> bytes of data from the ring buffer <code>rb</code> and return the pointer to the start of data. The <a class="el" href="group__rb.html#gga230d72d2e2b2f19edfb9e211c8afbb7ba29aea0fcb4274b01a094e17c58739760">U_RB_OPT_USE_CONTIGUOUS_MEM</a> option must have been set when creating <code>rb</code>.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rb</em>&nbsp;</td><td>reference to an already allocated <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object where data will be read from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pb_sz</em>&nbsp;</td><td>number of bytes that the caller wants to be read. On successful return (i.e. non <code>NULL</code>) the value will be filled with the number of bytes actually read.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the address to the start of read data, or <code>NULL</code> on error (which includes the "no data ready" condition).</dd></dl>
<dl class="note"><dt><b>Note:</b></dt><dd>In case there is no data ready to be read a <code>NULL</code> is returned, with <code>*pb_sz == 0</code>. Any other error condition won't touch the supplied <code>*pb_sz</code> value. </dd></dl>

<p>Definition at line <a class="el" href="srcs_2toolbox_2rb_8c_source.html#l00278">278</a> of file <a class="el" href="srcs_2toolbox_2rb_8c_source.html">srcs/toolbox/rb.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga132894d36be7982b808a7e0024866ffd"></a><!-- doxytag: member="rb.h::u_rb_free" ref="ga132894d36be7982b808a7e0024866ffd" args="(u_rb_t *rb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void u_rb_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rb</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Dispose the previously allocated <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object <code>rb</code> </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rb</em>&nbsp;</td><td>reference to the <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object that must be disposed</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>nothing </dd></dl>

<p>Definition at line <a class="el" href="srcs_2toolbox_2rb_8c_source.html#l00176">176</a> of file <a class="el" href="srcs_2toolbox_2rb_8c_source.html">srcs/toolbox/rb.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga7d02dec994d832f541552181c74db248"></a><!-- doxytag: member="rb.h::u_rb_read" ref="ga7d02dec994d832f541552181c74db248" args="(u_rb_t *rb, void *b, size_t b_sz)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t u_rb_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>b_sz</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Try to read <code>b_sz</code> bytes of data from the ring buffer <code>rb</code> and copy it to <code>b</code> </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rb</em>&nbsp;</td><td>reference to an already allocated <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object where data will be read from </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>reference to the memory block where data will be copied (must be pre-allocated by the caller and of <code>b_sz</code> bytes at least) </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b_sz</em>&nbsp;</td><td>number of bytes that the caller wants to be copied into <code>b</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of bytes actually read from the ring buffer (may be less than the requested size) </dd></dl>

<p>Definition at line <a class="el" href="srcs_2toolbox_2rb_8c_source.html#l00244">244</a> of file <a class="el" href="srcs_2toolbox_2rb_8c_source.html">srcs/toolbox/rb.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga22a6662e68557d3141d01eb97f0128d5"></a><!-- doxytag: member="rb.h::u_rb_ready" ref="ga22a6662e68557d3141d01eb97f0128d5" args="(u_rb_t *rb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t u_rb_ready </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rb</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return the number of bytes ready to be consumed for the supplied <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object <code>rb</code> </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rb</em>&nbsp;</td><td>reference to an already allocated <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of bytes ready to be consumed (could be <code>0</code>) </dd></dl>

<p>Definition at line <a class="el" href="srcs_2toolbox_2rb_8c_source.html#l00313">313</a> of file <a class="el" href="srcs_2toolbox_2rb_8c_source.html">srcs/toolbox/rb.c</a>.</p>

</div>
</div>
<a class="anchor" id="gab957d383db17b16b4797f349cea3b896"></a><!-- doxytag: member="rb.h::u_rb_size" ref="gab957d383db17b16b4797f349cea3b896" args="(u_rb_t *rb)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t u_rb_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rb</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return the real size (as possibly rounded by the <a class="el" href="group__rb.html#ga5f6b8d62ce4228bf6dbdc6940dccc8ac" title="Create a new ring buffer object.">u_rb_create</a> routine) of the supplied <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object <code>rb</code> </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rb</em>&nbsp;</td><td>reference to an already allocated <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the size in bytes of the ring buffer </dd></dl>

<p>Definition at line <a class="el" href="srcs_2toolbox_2rb_8c_source.html#l00193">193</a> of file <a class="el" href="srcs_2toolbox_2rb_8c_source.html">srcs/toolbox/rb.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga502c54f19c503be57950769ca9b6601a"></a><!-- doxytag: member="rb.h::u_rb_write" ref="ga502c54f19c503be57950769ca9b6601a" args="(u_rb_t *rb, const void *b, size_t b_sz)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t u_rb_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18">u_rb_t</a> *&nbsp;</td>
          <td class="paramname"> <em>rb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&nbsp;</td>
          <td class="paramname"> <em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>b_sz</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Try to write <code>b_sz</code> bytes of data from the memory block <code>b</code> to the <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object <code>rb</code> </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>rb</em>&nbsp;</td><td>reference to an already allocated <a class="el" href="group__rb.html#gaea2a7071b45141bf4dab0020f7adca18" title="The ring buffer type.">u_rb_t</a> object where data will be written to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b</em>&nbsp;</td><td>reference to the memory block which will be copied-in </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>b_sz</em>&nbsp;</td><td>number of bytes starting from <code>b</code> that the caller wants to be copied into <code>rb</code> </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>the number of bytes actually written to the ring buffer (may be less than the requested size) </dd></dl>

<p>Definition at line <a class="el" href="srcs_2toolbox_2rb_8c_source.html#l00213">213</a> of file <a class="el" href="srcs_2toolbox_2rb_8c_source.html">srcs/toolbox/rb.c</a>.</p>

</div>
</div>
</div>
<hr>
<div>
  <div style="text-align:left">
    <a href="http://www.koanlogic.com/products.html">&larr;Products</a>
  </div>
  <div style="text-align:center;">
    &copy; 2005-2012 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
  </div>
</div>

</body>
</html>
